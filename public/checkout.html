<!DOCTYPE html>
<html lang="eng">

<head>
    <meta charset="UTF-8">
    <meta name="description" content="Vitronics Technologies">
    <meta name="keywords" content="Vitronics, VitronicsTech, Automation, Engineering">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>Vitronics | Technologies</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">

    <!-- Google Font -->
    <link href="https://fonts.googleapis.com/css2?family=Cairo:wght@200;300;400;600;900&display=swap" rel="stylesheet">

    <!-- Css Styles -->
    <link rel="stylesheet" href="./css/bootstrap.min.css" type="text/css">
    <link rel="stylesheet" href="./css/font-awesome.min.css" type="text/css">
    <link rel="stylesheet" href="./css/elegant-icons.css" type="text/css">
    <link rel="stylesheet" href="./css/nice-select.css" type="text/css">
    <link rel="stylesheet" href="./css/jquery-ui.min.css" type="text/css">
    <link rel="stylesheet" href="./css/owl.carousel.min.css" type="text/css">
    <link rel="stylesheet" href="./css/slicknav.min.css" type="text/css">
    <link rel="stylesheet" href="./css/style.css" type="text/css">

       <style>
           /* body { font-family: Arial, sans-serif; padding: 20px; } */
           table { width: 75%;  border-collapse: collapse; margin: 20px auto; }
           th, td { padding: 10px; border: 1px solid #ddd; text-align: center; }
           th { background-color: #f4f4f4; }
           

           .total { text-align: right; margin-top: 20px; font-weight: bold; }
       </style> 
</head>

<body>
    <!-- Page Preloder -->
    <!-- <div id="preloder">
        <div class="loader"></div>
    </div> -->
 <!-- Humberger Begin -->
 <div class="humberger__menu__overlay"></div>
 <div class="humberger__menu__wrapper">
     <div class="humberger__menu__logo">
         <a href="#"><img src="img/Vitronicstech_logo5.PNG" alt="company logo"></a>
     </div>
     <div class="humberger__menu__cart">
        <ul>
            <!-- <li><a href=""><i class="fa fa-heart"></i> <span id="wishlist-count">0</span></a></li> -->
             <li><a href="shopping-cart.html"><i class="fa fa-shopping-cart" ></i><span class="cart-count">0</span></a></li>
        
             <div class="">Total: <span class="total-price">ksh 0.00</span></div>
         </ul>
         <div class="header__cart__price">item: <span>Ksh 0.00</span></div>
     </div>
     <div class="humberger__menu__widget">
         <div class="header__top__right__auth">
         <a href="login.html" id="login-link-desktop"><i class="fa fa-user"></i> Login</a>
          <a href="#" id="logout-link-mobile" style="display: none;"><i class="fa fa-sign-out"></i> Logout</a>
         </div>
     </div>
     <nav class="humberger__menu__nav mobile-menu">
         <ul>
             <li class="active"><a href="./index.html">Home</a></li>
             <li><a href="./shop-grid.html">Shop</a></li>
             <li><a href="./shopping-cart.html">Shopping Cart</a></li>
                           <li><a href="#">Check Out</a></li>
             <!-- <li><a href="#">Pages</a>
                 <ul class="header__menu__dropdown">
                     <li><a href="./shop-details.html">Shop Details</a></li>
                     <li><a href="./shopping-cart.html">Shoping Cart</a></li>
                     
                 </ul>
             </li> -->
            
             <li><a href="./contact.html">Contact</a></li>
         </ul>
     </nav>
     <div id="mobile-menu-wrap"></div>
     <div class="header__top__right__social">
         <a href="#"><i class="fa fa-facebook"></i></a>
         <a href="#"><i class="fa fa-twitter"></i></a>
         <a href="#"><i class="fa fa-linkedin"></i></a>
         <!-- <a href="#"><i class="fa fa-pinterest-p"></i></a> -->
     </div>
     <div class="humberger__menu__contact">
         <ul>
             <li><i class="fa fa-envelope"></i> vitronicstech@gmai.com.com</li>
            
         </ul>
     </div>
 </div>
 <!-- Humberger End -->
    <!-- Header Section Begin -->
 <header class="header">
        <div class="header__top">
            <div class="container">
                <div class="row">
                    <div class="col-lg-6 col-md-6">
                        <div class="header__top__left">
                            <ul>
                                 <a href="Vitronicstech@gmail.com"><li><i class="fa fa-envelope"></i> Vitronicstech@gmail.com</li>
                               
                            </ul>
                        </div>
                    </div>
                    <div class="col-lg-6 col-md-6">
                        <div class="header__top__right">
                            <div class="header__top__right__social">
                                <a href="#"><i class="fa fa-facebook"></i></a>
                                <a href="#"><i class="fa fa-whatsapp"></i></a>
                                <a href="#"><i class="fa fa-linkedin"></i></a>
                               
                            </div>
                           
                            <div class="header__top__right__auth">
                               <a href="login.html" id="login-link-desktop"><i class="fa fa-user"></i> Login</a>
                                 <a href="#" id="logout-link-mobile" style="display: none;"><i class="fa fa-sign-out"></i> Logout</a>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <div class="container">
            <div class="row">
                <div class="col-lg-3">
                    <div class="header__logo">
                        <a href="./index.html"><img src="img/Vitronicstech_logo5.PNG" alt="company logo"></a>
                    </div>
                </div>
                <div class="col-lg-6">
                    <nav class="header__menu">
                        <ul>
                            <li class="active"><a href="./index.html">Home</a></li>
                            <li><a href="./shop-grid.html">Shop</a></li>
                           <li><a href="./shopping-cart.html">Shopping Cart</a></li>
                           <li><a href="#">Check Out</a></li>
             <!-- <li><a href="#">Pages</a>
                 <ul class="header__menu__dropdown">
                     <li><a href="./shop-details.html">Shop Details</a></li>
                     <li><a href="./shopping-cart.html">Shoping Cart</a></li>
                     
                 </ul>
             </li> -->
                           
                            <li><a href="./contact.html">Contact</a></li>
                        </ul>
                    </nav>
                </div>
                <!--  -->
            </div>
            <div class="humberger__open">
                <i class="fa fa-bars"></i>
            </div>
        </div>
    </header>

    <!-- Breadcrumb Section Begin -->
    <section class="breadcrumb-section set-bg" data-setbg="" style="background-color: rgb(45, 55, 112); height: 20px;padding:40px; margin-bottom: 30px;">
        <div class="container">
            <div class="row">
                <div class="col-lg-12 text-center">
                    <div class="breadcrumb__text">
                        <h2>CKECKOUT</h2>
                        <div class="breadcrumb__option">
                            <a href="./index.html">Home</a>
                            <span>Checkout</span>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </section>
  <!-- Breadcrumb End -->

  <!-- Checkout Begin -->
  <section class="checkout spad py-5">
    <div class="container">
      <form id="checkout-form">
        <div class="row">
          <div class="col-lg-8">
            <h4>Billing Details</h4>
            <div class="row">
              <div class="col-md-6 mb-3">
                <label for="first-name">First Name *</label>
                <input type="text" id="first-name" class="form-control" required>
              </div>
              <div class="col-md-6 mb-3">
                <label for="last-name">Last Name *</label>
                <input type="text" id="last-name" class="form-control" required>
              </div>
            </div>
          
            <div class="mb-3">
              <label for="city">Town/City *</label>
              <input type="text" id="city" class="form-control" required>
            </div>
          
            <div class="row">
              <div class="col-md-6 mb-3">
                <label for="phone">Phone *</label>
                <input type="tel" id="phone" class="form-control" required>
              </div>
              <div class="col-md-6 mb-3">
                <label for="email">Email *</label>
                <input type="email" id="email" class="form-control" required>
              </div>
            </div>
          
            <div class="mb-3">
              <label for="order-notes">Order Notes</label>
              <input type="text" id="order-notes" class="form-control" placeholder="Notes about your order, e.g. delivery instructions">
            </div>
          </div>

          <div class="col-lg-4">
            <div class="checkout__order p-4 border rounded">
              <h4>Your Order Summary</h4>
              <div class="checkout__order__products">Products <span>Total</span></div>
              <ul id="cart-items-list" class="list-group mb-3">
                <!-- Items will be injected here by JS -->
              </ul>
              <div class="d-flex justify-content-between">
                <strong>Subtotal:</strong> <span id="subtotal">Ksh 0.00</span>
              </div>
              <div class="d-flex justify-content-between mb-3">
                <strong>Total:</strong> <span id="total">Ksh 0.00</span>
              </div>
              <div class="form-check mb-2">
                <input type="checkbox" class="form-check-input" id="payment-check">
                <label class="form-check-label" for="payment-check">Check Payment</label>
              </div>
              <div class="form-check mb-4">
                <input type="checkbox" class="form-check-input" id="paypal">
                <label class="form-check-label" for="paypal">M-PESA</label>
              </div>
              <button type="submit" class="btn btn-primary w-100">PLACE ORDER</button>
             
            </div>
          </div>
        </div>
      </form>
    </div>
  </section>
  <!-- Checkout End -->


  <script>
  document.addEventListener('DOMContentLoaded', function() {
  const cartItemsList = document.getElementById('cart-items-list');
  const subtotalEl = document.getElementById('subtotal');
  const totalEl = document.getElementById('total');
  const checkoutForm = document.getElementById('checkout-form');
  
  // Load cart items on page load
  loadCartItems();

  async function loadCartItems() {
    try {
      const response = await fetch('/api/checkout/cart');
      if (!response.ok) throw new Error('Failed to load cart');
      
      const { items, total } = await response.json();
      renderCartItems(items, total);
    } catch (error) {
      console.error('Error loading cart:', error);
      showToast('Failed to load cart items', 'error');
      renderCartItems([], 0);
    }
  }

  function renderCartItems(items, total) {
    // Clear existing items
    cartItemsList.innerHTML = '';
    
    if (items.length === 0) {
      cartItemsList.innerHTML = `
        <li class="list-group-item text-center py-3">
          Your cart is empty
        </li>
      `;
      subtotalEl.textContent = 'Ksh 0.00';
      totalEl.textContent = 'Ksh 0.00';
      return;
    }

    // Add items to list
    items.forEach(item => {
      const li = document.createElement('li');
      li.className = 'list-group-item d-flex justify-content-between align-items-center';
      li.innerHTML = `
        ${item.product_name} 
        <span class="badge bg-primary rounded-pill">${item.quantity}</span>
        <span>Ksh ${(parseFloat(item.price) * item.quantity).toFixed(2)}</span>
      `;
      cartItemsList.appendChild(li);
    });

    // Update totals
    subtotalEl.textContent = `Ksh ${(parseFloat(total)).toFixed(2)}`;
    totalEl.textContent = `Ksh ${(parseFloat(total)).toFixed(2)}`;
  }

  // Handle form submission
  checkoutForm.addEventListener('submit', async function(e) {
    e.preventDefault();
    
    // Get form values
    const firstName = document.getElementById('first-name').value;
    const lastName = document.getElementById('last-name').value;
    const email = document.getElementById('email').value;
    const phone = document.getElementById('phone').value;
    const city = document.getElementById('city').value;
    const notes = document.getElementById('order-notes').value;
    
    // Get payment method
    const paymentMethod = document.getElementById('paypal').checked ? 'M-PESA' : 
                         document.getElementById('payment-check').checked ? 'Check' : '';
    
    if (!paymentMethod) {
      showToast('Please select a payment method', 'error');
      return;
    }

    // Get cart items
    const cartResponse = await fetch('/api/checkout/cart');
    if (!cartResponse.ok) {
      showToast('Failed to get cart items', 'error');
      return;
    }
    const { items, total } = await cartResponse.json();

    if (items.length === 0) {
      showToast('Your cart is empty', 'error');
      return;
    }

    // Submit order
    try {
      const response = await fetch('/api/checkout/order', {
        method: 'POST',
        headers: {
          'Content-Type': 'application/json'
        },
        body: JSON.stringify({
          firstName,
          lastName,
          email,
          phone,
          city,
          notes,
          paymentMethod,
          cartItems: items,
          totalAmount: total
        })
      });

      const result = await response.json();
      
      if (result.success) {
        showToast('Order placed successfully!', 'success');
        // Redirect to order confirmation page or clear form
        window.location.href = `/confirm.html?orderId=${result.orderId}`;
      } else {
        showToast(result.error || 'Failed to place order', 'error');
      }
    } catch (error) {
      console.error('Error placing order:', error);
      showToast('Failed to place order', 'error');
    }
  });

  // Toast notification function
  function showToast(message, type = 'success') {
    const toast = document.createElement('div');
    toast.className = `toast ${type}`;
    toast.textContent = message;
    document.body.appendChild(toast);
    
    setTimeout(() => {
      toast.classList.add('show');
      setTimeout(() => {
        toast.classList.remove('show');
        setTimeout(() => toast.remove(), 300);
      }, 3000);
    }, 100);

    // Add styles if not already present
    if (!document.getElementById('toast-styles')) {
      const style = document.createElement('style');
      style.id = 'toast-styles';
      style.textContent = `
        .toast {
          position: fixed;
          bottom: 20px;
          left: 50%;
          transform: translateX(-50%);
          background: #4CAF50;
          color: white;
          padding: 12px 24px;
          border-radius: 4px;
          opacity: 0;
          transition: opacity 0.3s;
          z-index: 1000;
        }
        .toast.error {
          background: #f44336;
        }
        .toast.show {
          opacity: 1;
        }
      `;
      document.head.appendChild(style);
    }
  }
});

  </script>

  <!-- JS -->
  
 <!-- Js Plugins -->
 <script src="js/jquery-3.3.1.min.js"></script>
 <script src="js/bootstrap.min.js"></script>
 <script src="js/jquery.nice-select.min.js"></script>
 <script src="js/jquery-ui.min.js"></script>
 <script src="js/jquery.slicknav.js"></script>
 <script src="js/mixitup.min.js"></script>
 <script src="js/owl.carousel.min.js"></script>
 <script src="js/main.js"></script>
 <script src="js/script.js"></script>
 <script src="./script.js"></script>
 <script src="js/login.js"></script>
 <script src="js/register.js"></script>

<script>
document.addEventListener('DOMContentLoaded', async function () {
  try {
    const response = await fetch('/api/cart', {
      headers: { 'Accept': 'application/json' }
    });

    if (!response.ok) throw new Error('Failed to fetch cart data');

    const data = await response.json();

    document.querySelectorAll('.cart-count').forEach(el => {
      el.textContent = data.cartCount || 0;
    });

    document.querySelectorAll('.total-price').forEach(el => {
      el.textContent = 'Ksh ' + (data.totalPrice || '0.00');
    });
  } catch (error) {
    console.error('Error loading cart count:', error);
  }
});
</script>


</body>

</html>
